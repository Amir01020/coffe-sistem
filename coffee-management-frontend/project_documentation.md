# Документация проекта Coffee Management System

## Общее описание

Coffee Management System - это веб-приложение для управления кофейней, разработанное с использованием Vue.js. Система позволяет администраторам управлять заказами, столиками, клиентами, а директору просматривать статистику и отчеты о работе заведения.

## Структура проекта

### Основные директории

- `/src` - исходный код приложения
  - `/assets` - статические ресурсы (изображения, стили)
  - `/components` - переиспользуемые компоненты Vue
  - `/layouts` - макеты для разных типов страниц
  - `/router` - конфигурация маршрутизации
  - `/services` - сервисы для работы с API
  - `/stores` - хранилища состояния (Pinia)
  - `/utils` - утилиты и вспомогательные функции
  - `/views` - компоненты страниц

## Ключевые файлы и их назначение

### Конфигурация и настройка

#### `/src/router/index.js`
Файл содержит конфигурацию маршрутизации приложения. Определяет все доступные маршруты и их компоненты, а также защиту маршрутов на основе ролей пользователей.

Основные маршруты:
- `/login` - страница авторизации
- `/admin` - панель администратора
- `/director` - панель директора
- `/director/reports` - страница отчетов для директора
- `/director/reports/clients` - отчет по клиентам
- `/director/reports/shifts` - отчет по сменам

Также включает навигационный guard `beforeEach`, который проверяет аутентификацию и права доступа.

### Сервисы

#### `/src/services/api.js`
Сервис для взаимодействия с бэкендом. Настраивает Axios для выполнения HTTP-запросов, добавляет токен аутентификации в заголовки и обрабатывает ответы и ошибки.

### Утилиты

#### `/src/utils/formatters.js`
Содержит функции форматирования данных:

- `formatCurrency(amount)` - форматирует числовые значения в денежный формат с добавлением "сум"
- `formatTime(dateString)` - форматирует время в формате ЧЧ:ММ
- `formatDateTime(dateString)` - форматирует дату и время
- `formatDate(dateString)` - форматирует только дату
- `getDuration(startTime, endTime)` - вычисляет продолжительность между двумя датами
- `getRemainingTime(endTime)` - вычисляет оставшееся время до указанной даты
- `formatPhone(phone)` - форматирует номер телефона в удобочитаемый вид
- `toDateInputValue(date)` - преобразует дату для использования в input[type="date"]
- `toDateTimeInputValue(date)` - преобразует дату для использования в input[type="datetime-local"]

### Хранилища (Stores)

#### `/src/stores/reports.js`
Хранилище Pinia для управления данными отчетов. Содержит:

- Состояние для хранения отчетов по выручке, сменам, клиентам и ежедневным данным
- Методы для загрузки данных с сервера:
  - `fetchRevenueReport` - загружает отчет по выручке
  - `fetchShiftsReport` - загружает отчет по сменам
  - `fetchClientsReport` - загружает отчет по клиентам
  - `fetchDailyReport` - загружает ежедневный отчет

### Макеты (Layouts)

#### `/src/layouts/DirectorLayout.vue`
Макет для страниц директора. Включает боковое меню навигации, верхнюю панель и основную область контента.

### Компоненты представления (Views)

#### Страницы директора

##### `/src/views/director/Dashboard.vue`
Главная страница панели директора. Отображает основные показатели работы заведения:

- Общая выручка
- Количество заказов
- Средний чек
- Количество клиентов
- График динамики выручки
- Таблица эффективности администраторов

Функциональность:
- Фильтрация данных по периоду (сегодня, вчера, неделя, месяц, произвольный период)
- Загрузка данных с сервера через API
- Обработка и отображение статистики

##### `/src/views/director/Reports.vue`
Страница навигации по отчетам. Содержит карточки для перехода к различным типам отчетов:
- Общая выручка (ссылка на Dashboard)
- Отчет по сменам
- Отчет по клиентам

Также отображает сводную статистику с возможностью выбора периода.

##### `/src/views/director/ClientsReport.vue`
Страница с детальным отчетом по клиентам. Включает:
- Фильтры для выбора периода и сортировки
- Статистические карточки (общее количество клиентов, общая выручка, средний чек)
- Таблицу клиентов с информацией о контактах, количестве визитов, потраченных средствах и последнем визите

##### `/src/views/director/ShiftsReport.vue`
Страница с отчетом по сменам. Включает:
- Фильтры для выбора периода и администратора
- Статистические карточки (общее количество смен, общая выручка, средняя выручка за смену)
- Таблицу смен с информацией о администраторе, времени начала и окончания, продолжительности, выручке и количестве заказов

#### Страницы администратора

##### `/src/views/admin/Dashboard.vue`
Панель управления для администратора. Отображает:
- Текущую статистику за день (выручка, заказы, средний чек, количество клиентов)
- Информацию о текущих активных столиках
- Функции для управления заказами и столиками

Функциональность:
- Автоматическое обновление данных
- Расчет дневной выручки на основе заказов и VIP-сессий
- Обработка потенциально пустых значений от API

## Особенности реализации

### Обработка данных

1. **Форматирование валюты**:
   - Все денежные значения форматируются с использованием `formatCurrency` из `formatters.js`
   - Функция обрабатывает null, undefined и строковые значения, преобразуя их в числа
   - Добавляет " сум" после форматированного числа

2. **Загрузка данных**:
   - Все запросы к API выполняются через сервис `api.js`
   - Реализована обработка ошибок и пустых значений
   - Для Dashboard директора реализован запасной вариант расчета выручки, если API не возвращает данные

3. **Обновление данных**:
   - На странице Dashboard администратора данные обновляются автоматически через заданные интервалы
   - На страницах директора данные обновляются при изменении фильтров или по кнопке "Обновить"

### Безопасность

- Реализована защита маршрутов на основе ролей пользователей
- Токен аутентификации автоматически добавляется к запросам API
- Проверка прав доступа выполняется при каждой навигации

## Взаимодействие компонентов

1. **Маршрутизация**:
   - `router/index.js` определяет доступные маршруты
   - Компоненты макетов (`DirectorLayout.vue`) используются как контейнеры для страниц
   - Страницы (`Dashboard.vue`, `Reports.vue` и др.) отображаются внутри макетов

2. **Управление состоянием**:
   - Хранилище `reports.js` управляет данными отчетов
   - Компоненты страниц используют хранилище для получения и отображения данных

3. **API взаимодействие**:
   - Сервис `api.js` используется для выполнения запросов к серверу
   - Компоненты и хранилища используют этот сервис для загрузки данных

## Обработка ошибок

1. **Проверка данных**:
   - Все компоненты проверяют полученные данные на null/undefined
   - Реализованы запасные варианты для случаев, когда API возвращает некорректные данные

2. **Отображение ошибок**:
   - Используются всплывающие сообщения для уведомления пользователя об ошибках
   - Реализованы состояния загрузки для индикации процесса получения данных

## Пользовательский интерфейс

1. **Компоненты UI**:
   - Используются иконки из библиотеки Heroicons
   - Реализованы карточки, таблицы, формы и другие элементы интерфейса
   - Адаптивный дизайн для различных размеров экрана

2. **Состояния интерфейса**:
   - Состояния загрузки с анимированными индикаторами
   - Состояния пустых данных с информативными сообщениями
   - Интерактивные элементы с эффектами наведения и нажатия 